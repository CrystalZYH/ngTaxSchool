layer.use("skin/layer.ext.css",function(){layer.ext&&layer.ext()});layer.prompt=function(A,D,E){var C={},A=A||{},B={area:["auto","auto"],offset:[A.top||"",""],title:A.title||"信息",dialog:{btns:2,type:-1,msg:'<input type="'+function(){if(A.type===1){return"password"}else{if(A.type===2){return"file"}else{return"text"}}}()+'" class="xubox_prompt xubox_form" id="xubox_prompt" value="'+(A.val||"")+'" />',yes:function(F){var G=C.prompt.val();if(G===""){C.prompt.focus()}else{if(G.replace(/\s/g,"").length>(A.length||1000)){layer.tips("最多输入"+(A.length||1000)+"个字数","#xubox_prompt",2)}else{D&&D(G,F,C.prompt)}}},no:E},success:function(){C.prompt=$("#xubox_prompt");C.prompt.focus()}};if(A.type===3){B.dialog.msg='<textarea class="xubox_prompt xubox_form xubox_formArea" id="xubox_prompt">'+(A.val||"")+"</textarea>"}return $.layer(B)};layer.tab=function(A){var C={},A=A||{},D=A.data||[],B={type:1,border:[0],area:["auto","auto"],bgcolor:"",title:false,shade:A.shade,offset:A.offset,move:".xubox_tabmove",closeBtn:false,page:{html:'<div class="xubox_tab" style="'+function(){A.area=A.area||[];return"width:"+(A.area[0]||"500px")+"; height:"+(A.area[1]||"300px")+'">'}()+'<span class="xubox_tabmove"></span><div class="xubox_tabtit">'+function(){var G=D.length,F=1,E="";if(G>0){E='<span class="xubox_tabnow">'+D[0].title+"</span>";for(;F<G;F++){E+="<span>"+D[F].title+"</span>"}}return E}()+'</div><ul class="xubox_tab_main">'+function(){var G=D.length,F=1,E="";if(G>0){E='<li class="xubox_tabli xubox_tab_layer">'+(D[0].content||"content未传入")+"</li>";for(;F<G;F++){E+='<li class="xubox_tabli">'+(D[F].content||"content未传入")+"</li>"}}return E}()+'</ul><span class="xubox_tabclose" title="关闭">X</span></div>'},success:function(E){var G=$(".xubox_tabtit").children(),F=$(".xubox_tab_main").children(),H=$(".xubox_tabclose");G.on("click",function(){var J=$(this),I=J.index();J.addClass("xubox_tabnow").siblings().removeClass("xubox_tabnow");F.eq(I).show().siblings().hide()});H.on("click",function(){layer.close(E.attr("times"))})}};return $.layer(B)};layer.photos=function(F){F=F||{};var I={imgIndex:1,end:null,html:$("html")},G=$(window),D=F.json,B=F.page;if(D){var A=D.data;if(D.status===1){I.imgLen=A.length;if(A.length>0){I.thissrc=A[D.start].src;I.pid=A[D.start].pid;I.imgsname=(D.title||"");I.name=A[D.start].name;I.imgIndex=D.start+1}else{layer.msg("没有任何图片",2,8);return}}else{layer.msg("未请求到数据",2,8);return}}else{var E=$(B.parent).find("img"),C=E.eq(B.start);I.thissrc=(C.attr("layer-img")||C.attr("src"));I.pid=C.attr("pid");I.imgLen=E.length;I.imgsname=(B.title||"");I.name=C.attr("alt");I.imgIndex=B.start+1}var H={type:1,border:[0],area:[(F.html?915:600)+"px","auto"],title:false,shade:[0.9,"#000",true],shadeClose:true,offset:["25px",""],bgcolor:"",page:{html:'<div class="xubox_bigimg"><img src="'+I.thissrc+'" alt="'+(I.name||"")+'" layer-pid="'+(I.pid||"")+'"><div class="xubox_imgsee">'+function(){if(I.imgLen>1){return'<a href="" class="xubox_iconext xubox_prev"></a><a href="" class="xubox_iconext xubox_next"></a>'}else{return""}}()+'<div class="xubox_imgbar"><span class="xubox_imgtit"><a href="javascript:;">'+I.imgsname+" </a><em>"+I.imgIndex+"/"+I.imgLen+"</em></span></div></div></div>"+function(){if(F.html){return'<div class="xubox_intro">'+F.html+"</div>"}else{return""}}()},success:function(J){I.bigimg=J.find(".xubox_bigimg");I.imgsee=I.bigimg.find(".xubox_imgsee");I.imgbar=I.imgsee.find(".xubox_imgbar");I.imgtit=I.imgbar.find(".xubox_imgtit");I.layero=J;var K=I.imgs=I.bigimg.find("img");clearTimeout(I.timerr);I.timerr=setTimeout(function(){$("html").css("overflow","hidden").attr("layer-full",I.index)},10);K.load(function(){I.imgarea=[K.outerWidth(),K.outerHeight()];I.resize(J)});I.event()},end:function(){layer.closeAll();I.end=true}};I.event=function(){I.bigimg.hover(function(){I.imgsee.show()},function(){I.imgsee.hide()});H.imgprev=function(){I.imgIndex--;if(I.imgIndex<1){I.imgIndex=I.imgLen}I.tabimg()};I.bigimg.find(".xubox_prev").on("click",function(J){J.preventDefault();H.imgprev()});H.imgnext=function(){I.imgIndex++;if(I.imgIndex>I.imgLen){I.imgIndex=1}I.tabimg()};I.bigimg.find(".xubox_next").on("click",function(J){J.preventDefault();H.imgnext()});$(document).keyup(function(K){if(!I.end){var J=K.keyCode;K.preventDefault();if(J===37){H.imgprev()}else{if(J===39){H.imgnext()}else{if(J===27){layer.close(I.index)}}}}});I.tabimg=function(){var K,O,J,L;I.imgs.removeAttr("style");if(D){var N=A[I.imgIndex-1];O=N.src;J=N.pid;L=N.name}else{var M=E.eq(I.imgIndex-1);O=M.attr("layer-img")||M.attr("src");J=M.attr("layer-pid")||"";L=M.attr("alt")||""}I.imgs.attr({src:O,"layer-pid":J,alt:L});I.imgtit.find("em").text(I.imgIndex+"/"+I.imgLen);I.imgsee.show();F.tab&&F.tab({pid:J,name:L})}};I.resize=function(J){var K={},L=[G.width(),G.height()];K.limit=L[0]-L[0]/L[1]*(60*L[0]/L[1]);if(K.limit<600){K.limit=600}var M=[K.limit,L[1]>400?L[1]-50:400];M[0]=F.html?M[0]:(M[0]-300);layer.area(I.index,{width:M[0]+(F.html?15:0),height:M[1]});K.flwidth=M[0]-(F.html?300:0);if(I.imgarea[0]>K.flwidth){I.imgs.css({width:K.flwidth})}else{I.imgs.css({width:I.imgarea[0]})}if(I.imgs.outerHeight()<M[1]){I.imgs.css({top:(M[1]-I.imgs.outerHeight())/2})}I.imgs.css({visibility:"visible"});I.bigimg.css({width:K.flwidth,height:M[1],"background-color":F.bgcolor});if(F.html){J.find(".xubox_intro").css({height:M[1]})}K=null;L=null;M=null};G.on("resize",function(){if(I.end){return}if(I.timer){clearTimeout(I.timer)}I.timer=setTimeout(function(){I.resize(I.layero)},200)});I.index=$.layer(H);return I.index};layer.photosPage=function(A){var B={};B.run=function(C){layer.photos({html:A.html,success:A.success,page:{title:A.title,id:A.id,start:C,parent:A.parent}})};A=A||{};$(A.parent).find("img").each(function(C){$(this).on("click",function(){B.run(C)})})};