$.extend({dragIcon:{}});$.extend($.dragIcon,{className:"",menuUrl:"data.jsp",sortSaveUrl:"sortsave.jsp",drag:function(C,A,E,D){var B=this.className="#"+C+" "+A;this.menuUrl=E||this.menuUrl;this.sortSaveUrl=D||this.sortSaveUrl;$(B).draggable({revert:true,cursor:"pointer",proxy:"clone",onStartDrag:function(){var F=$(this).draggable("proxy").css("z-index",40);$(this).draggable("proxy").css({opacity:0.6});$(this).draggable("proxy").attr("id","proxy___li");F.hide();setTimeout(function(){F.show()},300)}});var C=this;$(B).droppable({onDragEnter:function(F,G){$(this).addClass("curr")},onDragLeave:function(F,G){if($(B).index(this)!=0){$(this).removeClass("curr")}},onDrop:function(G,H){var F=$(B).index(H),I=$(B).index(this);if(F>I){$(H).insertBefore(this)}else{$(H).insertAfter(this)}$("#proxy___li").remove();$(this).removeClass("curr");C.saveSortChild()}});this.bindClickEvent()},bindClickEvent:function(){var A=this;$(this.className).bind("click",function(B){$(A.className).removeClass("curr");$(this).addClass("curr");var C=$(this).text();if($("#menutitle").html()!=C){$("#menutitle").html(C);$.post(A.menuUrl,{menuId:$(this).attr("id")},function(D){$.dragIcon.addMenu(D)})}})},addTab:function(A,B,C){if(!$(".easyui-tabs").tabs("exists",A)){$(".easyui-tabs").tabs("add",{title:A,content:function(D){var E='<iframe scrolling="auto" frameborder="0"  src="'+D+'" style="width:100%;height:100%;overflow-y:hidden" ></iframe>';return E}(B),closable:true,icon:C})}else{$(".easyui-tabs").tabs("select",A);$("#mm-tabupdate").click()}},iconToggle:function(B){var A=function(C){C.animate({height:"70px"},function(){C.css({"background-color":""})});C.removeAttr("sign")};$("#"+B).bind("click",function(D){if($("#"+B).prev().children().length<=7){return}var F=$(this).parent();if(!F.attr("sign")){F.css({"background-color":"#1f78b6"});var E=Math.ceil(F.find("li").length/7);var C=E*63+5*2*(E+1);F.animate({height:C});F.attr("sign","1")}else{A(F)}});$("#"+B).parent().bind("mouseleave",function(){if($("#"+B).prev().children().length<=7){return}A($(this))})},saveSortChild:function(){var A="<root>";$(this.className).each(function(B){A+='<node index="'+B+'" name="'+$(this).text()+'" id="'+$(this).attr("id")+'"/>'});A+="</root>";$.ajax({url:this.sortSaveUrl,type:"POST",data:{iconList:A},error:function(){alert("网络异常,排序未保存")},success:function(){}});return $(this.className)},addMenu:function(E){var C=$(E);$("#nav").accordion({animate:false});var A=$("#nav").accordion("panels");var G=A.length;var H=[];for(var D=0;D<G;D++){var B=A[D].panel("options").title;H[D]=B}for(var D=0;D<G;D++){$("#nav").accordion("remove",H[D])}for(var D=0;D<C.length;D++){var F=$(C[D]);$("#nav").accordion("add",{title:F.attr("title"),content:"<ul>"+F.html()+"</ul>",iconCls:"icon "+F.icon})}$(".easyui-accordion li a").click(function(){var K=$(this).children(".nav").text();var J=$(this).attr("rel");var I=$(this).attr("ref");var L="";$.dragIcon.addTab(K,J,L);$(".easyui-accordion li div").removeClass("selected");$(this).parent().addClass("selected")}).hover(function(){$(this).parent().addClass("hover")},function(){$(this).parent().removeClass("hover")})}});function msgShow(C,B,A){$.messager.alert(C,B,A)};