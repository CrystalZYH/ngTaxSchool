(function(D){function A(G){var I=D.data(G,"menubutton").options;var J=D(G);J.removeClass(I.cls.btn1+" "+I.cls.btn2).addClass("m-btn");J.linkbutton(D.extend({},I,{text:I.text+'<span class="'+I.cls.arrow+'">&nbsp;</span>'}));if(I.menu){D(I.menu).menu();var E=D(I.menu).menu("options");var F=E.onShow;var H=E.onHide;D.extend(E,{onShow:function(){var M=D(this).menu("options");var L=D(M.alignTo);var K=L.menubutton("options");L.addClass((K.plain==true)?K.cls.btn2:K.cls.btn1);F.call(this)},onHide:function(){var K=D(this).menu("options");var L=D(K.alignTo);var M=L.menubutton("options");L.removeClass((M.plain==true)?M.cls.btn2:M.cls.btn1);H.call(this)}})}C(G,I.disabled)}function C(G,F){var E=D.data(G,"menubutton").options;E.disabled=F;var I=D(G);var J=I.find("."+E.cls.trigger);if(!J.length){J=I}J.unbind(".menubutton");if(F){I.linkbutton("disable")}else{I.linkbutton("enable");var H=null;J.bind("click.menubutton",function(){B(G);return false}).bind("mouseenter.menubutton",function(){H=setTimeout(function(){B(G)},E.duration);return false}).bind("mouseleave.menubutton",function(){if(H){clearTimeout(H)}})}}function B(H){var G=D.data(H,"menubutton").options;if(G.disabled||!G.menu){return}D("body>div.menu-top").menu("hide");var E=D(H);var F=D(G.menu);if(F.length){F.menu("options").alignTo=E;F.menu("show",{alignTo:E})}E.blur()}D.fn.menubutton=function(E,G){if(typeof E=="string"){var F=D.fn.menubutton.methods[E];if(F){return F(this,G)}else{return this.linkbutton(E,G)}}E=E||{};return this.each(function(){var H=D.data(this,"menubutton");if(H){D.extend(H.options,E)}else{D.data(this,"menubutton",{options:D.extend({},D.fn.menubutton.defaults,D.fn.menubutton.parseOptions(this),E)});D(this).removeAttr("disabled")}A(this)})};D.fn.menubutton.methods={options:function(E){var G=E.linkbutton("options");var F=D.data(E[0],"menubutton").options;F.toggle=G.toggle;F.selected=G.selected;return F},enable:function(E){return E.each(function(){C(this,false)})},disable:function(E){return E.each(function(){C(this,true)})},destroy:function(E){return E.each(function(){var F=D(this).menubutton("options");if(F.menu){D(F.menu).menu("destroy")}D(this).remove()})}};D.fn.menubutton.parseOptions=function(E){var F=D(E);return D.extend({},D.fn.linkbutton.parseOptions(E),D.parser.parseOptions(E,["menu",{plain:"boolean",duration:"number"}]))};D.fn.menubutton.defaults=D.extend({},D.fn.linkbutton.defaults,{plain:true,menu:null,duration:100,cls:{btn1:"m-btn-active",btn2:"m-btn-plain-active",arrow:"m-btn-downarrow",trigger:"m-btn"}})})(jQuery);