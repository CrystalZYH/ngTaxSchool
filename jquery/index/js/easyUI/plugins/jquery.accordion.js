(function(K){function O(Q){var Y=K.data(Q,"accordion");var X=Y.options;var V=Y.panels;var R=K(Q);X.fit?K.extend(X,R._fit()):R._fit(false);if(!isNaN(X.width)){R._outerWidth(X.width)}else{R.css("width","")}var T=0;var W="auto";var S=R.find(">div.panel>div.accordion-header");if(S.length){T=K(S[0]).css("height","")._outerHeight()}if(!isNaN(X.height)){R._outerHeight(X.height);W=R.height()-T*S.length}else{R.css("height","")}U(true,W-U(false)+1);function U(Z,c){var e=0;for(var a=0;a<V.length;a++){var d=V[a];var b=d.panel("header")._outerHeight(T);if(d.panel("options").collapsible==Z){var f=isNaN(c)?undefined:(c+T*b.length);d.panel("resize",{width:R.width(),height:(Z?f:undefined)});e+=d.panel("panel").outerHeight()-T}}return e}}function L(V,X,U,R){var W=K.data(V,"accordion").panels;var S=[];for(var T=0;T<W.length;T++){var Q=W[T];if(X){if(Q.panel("options")[X]==U){S.push(Q)}}else{if(Q[0]==K(U)[0]){return T}}}if(X){return R?S:(S.length?S[0]:null)}else{return -1}}function J(Q){return L(Q,"collapsed",false,true)}function D(Q){var R=J(Q);return R.length?R[0]:null}function F(R,Q){return L(R,null,Q)}function A(R,Q){var S=K.data(R,"accordion").panels;if(typeof Q=="number"){if(Q<0||Q>=S.length){return null}else{return S[Q]}}return L(R,"title",Q)}function P(S){var R=K.data(S,"accordion").options;var Q=K(S);if(R.border){Q.removeClass("accordion-noborder")}else{Q.addClass("accordion-noborder")}}function G(S){var R=K.data(S,"accordion");var Q=K(S);Q.addClass("accordion");R.panels=[];Q.children("div").each(function(){var T=K.extend({},K.parser.parseOptions(this),{selected:(K(this).attr("selected")?true:undefined)});var U=K(this);R.panels.push(U);I(S,U,T)});Q.bind("_resize",function(U,T){var V=K.data(S,"accordion").options;if(V.fit==true||T){O(S)}return false})}function I(R,S,Q){var T=K.data(R,"accordion").options;S.panel(K.extend({},{collapsible:true,minimizable:false,maximizable:false,closable:false,doSize:false,collapsed:true,headerCls:"accordion-header",bodyCls:"accordion-body"},Q,{onBeforeExpand:function(){if(Q.onBeforeExpand){if(Q.onBeforeExpand.call(this)==false){return false}}if(!T.multiple){var X=K.grep(J(R),function(a){return a.panel("options").collapsible});for(var Y=0;Y<X.length;Y++){C(R,F(R,X[Y]))}}var Z=K(this).panel("header");Z.addClass("accordion-header-selected");Z.find(".accordion-collapse").removeClass("accordion-expand")},onExpand:function(){if(Q.onExpand){Q.onExpand.call(this)}T.onSelect.call(R,K(this).panel("options").title,F(R,this))},onBeforeCollapse:function(){if(Q.onBeforeCollapse){if(Q.onBeforeCollapse.call(this)==false){return false}}var X=K(this).panel("header");X.removeClass("accordion-header-selected");X.find(".accordion-collapse").addClass("accordion-expand")},onCollapse:function(){if(Q.onCollapse){Q.onCollapse.call(this)}T.onUnselect.call(R,K(this).panel("options").title,F(R,this))}}));var V=S.panel("header");var U=V.children("div.panel-tool");U.children("a.panel-tool-collapse").hide();var W=K('<a href="javascript:void(0)"></a>').addClass("accordion-collapse accordion-expand").appendTo(U);W.bind("click",function(){var X=F(R,S);if(S.panel("options").collapsed){H(R,X)}else{C(R,X)}return false});S.panel("options").collapsible?W.show():W.hide();V.click(function(){K(this).find("a.accordion-collapse:visible").triggerHandler("click");return false})}function H(S,T){var R=A(S,T);if(!R){return}E(S);var Q=K.data(S,"accordion").options;R.panel("expand",Q.animate)}function C(T,S){var R=A(T,S);if(!R){return}E(T);var Q=K.data(T,"accordion").options;R.panel("collapse",Q.animate)}function N(Q){var T=K.data(Q,"accordion").options;var R=L(Q,"selected",true);if(R){S(F(Q,R))}else{S(T.selected)}function S(U){var V=T.animate;T.animate=false;H(Q,U);T.animate=V}}function E(R){var S=K.data(R,"accordion").panels;for(var Q=0;Q<S.length;Q++){S[Q].stop(true,true)}}function B(V,R){var Q=K.data(V,"accordion");var U=Q.options;var T=Q.panels;if(R.selected==undefined){R.selected=true}E(V);var S=K("<div></div>").appendTo(V);T.push(S);I(V,S,R);O(V);U.onAdd.call(V,R.title,T.length-1);if(R.selected){H(V,T.length-1)}}function M(V,X){var W=K.data(V,"accordion");var Q=W.options;var S=W.panels;E(V);var R=A(V,X);var U=R.panel("options").title;var T=F(V,R);if(!R){return}if(Q.onBeforeRemove.call(V,U,T)==false){return}S.splice(T,1);R.panel("destroy");if(S.length){O(V);var Y=D(V);if(!Y){H(V,0)}}Q.onRemove.call(V,U,T)}K.fn.accordion=function(R,Q){if(typeof R=="string"){return K.fn.accordion.methods[R](this,Q)}R=R||{};return this.each(function(){var S=K.data(this,"accordion");if(S){K.extend(S.options,R)}else{K.data(this,"accordion",{options:K.extend({},K.fn.accordion.defaults,K.fn.accordion.parseOptions(this),R),accordion:K(this).addClass("accordion"),panels:[]});G(this)}P(this);O(this);N(this)})};K.fn.accordion.methods={options:function(Q){return K.data(Q[0],"accordion").options},panels:function(Q){return K.data(Q[0],"accordion").panels},resize:function(Q){return Q.each(function(){O(this)})},getSelections:function(Q){return J(Q[0])},getSelected:function(Q){return D(Q[0])},getPanel:function(Q,R){return A(Q[0],R)},getPanelIndex:function(Q,R){return F(Q[0],R)},select:function(Q,R){return Q.each(function(){H(this,R)})},unselect:function(Q,R){return Q.each(function(){C(this,R)})},add:function(Q,R){return Q.each(function(){B(this,R)})},remove:function(Q,R){return Q.each(function(){M(this,R)})}};K.fn.accordion.parseOptions=function(R){var Q=K(R);return K.extend({},K.parser.parseOptions(R,["width","height",{fit:"boolean",border:"boolean",animate:"boolean",multiple:"boolean",selected:"number"}]))};K.fn.accordion.defaults={width:"auto",height:"auto",fit:false,border:true,animate:true,multiple:false,selected:0,onSelect:function(R,Q){},onUnselect:function(R,Q){},onAdd:function(Q,R){},onBeforeRemove:function(R,Q){},onRemove:function(R,Q){}}})(jQuery);