(function(U){function D(c){var d=U.data(c,"treegrid");var e=d.options;U(c).datagrid(U.extend({},e,{url:null,data:null,loader:function(){return false},onBeforeLoad:function(){return false},onLoadSuccess:function(){},onResizeColumn:function(f,g){Q(c);e.onResizeColumn.call(c,f,g)},onSortColumn:function(g,h){e.sortName=g;e.sortOrder=h;if(e.remoteSort){T(c)}else{var f=U(c).treegrid("getData");H(c,0,f)}e.onSortColumn.call(c,g,h)},onBeforeEdit:function(f,g){if(e.onBeforeEdit.call(c,g)==false){return false}},onAfterEdit:function(f,g,h){e.onAfterEdit.call(c,g,h)},onCancelEdit:function(f,g){e.onCancelEdit.call(c,g)},onSelect:function(f){e.onSelect.call(c,I(c,f))},onUnselect:function(f){e.onUnselect.call(c,I(c,f))},onSelectAll:function(){e.onSelectAll.call(c,U.data(c,"treegrid").data)},onUnselectAll:function(){e.onUnselectAll.call(c,U.data(c,"treegrid").data)},onCheck:function(f){e.onCheck.call(c,I(c,f))},onUncheck:function(f){e.onUncheck.call(c,I(c,f))},onCheckAll:function(){e.onCheckAll.call(c,U.data(c,"treegrid").data)},onUncheckAll:function(){e.onUncheckAll.call(c,U.data(c,"treegrid").data)},onClickRow:function(f){e.onClickRow.call(c,I(c,f))},onDblClickRow:function(f){e.onDblClickRow.call(c,I(c,f))},onClickCell:function(f,g){e.onClickCell.call(c,g,I(c,f))},onDblClickCell:function(g,f){e.onDblClickCell.call(c,f,I(c,g))},onRowContextMenu:function(f,g){e.onContextMenu.call(c,f,I(c,g))}}));if(!e.columns){var b=U.data(c,"datagrid").options;e.columns=b.columns;e.frozenColumns=b.frozenColumns}d.dc=U.data(c,"datagrid").dc;if(e.pagination){var a=U(c).datagrid("getPager");a.pagination({pageNumber:e.pageNumber,pageSize:e.pageSize,pageList:e.pageList,onSelectPage:function(g,f){e.pageNumber=g;e.pageSize=f;T(c)}});e.pageSize=a.pagination("options").pageSize}}function Q(d,f){var e=U.data(d,"datagrid").options;var a=U.data(d,"datagrid").dc;if(!a.body1.is(":empty")&&(!e.nowrap||e.autoRowHeight)){if(f!=undefined){var g=N(d,f);for(var b=0;b<g.length;b++){c(g[b][e.idField])}}}U(d).datagrid("fixRowHeight",f);function c(i){var k=e.finder.getTr(d,i,"body",1);var j=e.finder.getTr(d,i,"body",2);k.css("height","");j.css("height","");var h=Math.max(k.height(),j.height());k.css("height",h);j.css("height",h)}}function V(a){var c=U.data(a,"datagrid").dc;var b=U.data(a,"treegrid").options;if(!b.rownumbers){return}c.body1.find("div.datagrid-cell-rownumber").each(function(d){U(this).html(d+1)})}function A(d){var b=U.data(d,"datagrid").dc;var c=b.body1.add(b.body2);var a=(U.data(c[0],"events")||U._data(c[0],"events")).click[0].handler;b.body1.add(b.body2).bind("mouseover",function(f){var h=U(f.target);var g=h.closest("tr.datagrid-row");if(!g.length){return}if(h.hasClass("tree-hit")){h.hasClass("tree-expanded")?h.addClass("tree-expanded-hover"):h.addClass("tree-collapsed-hover")}f.stopPropagation()}).bind("mouseout",function(f){var h=U(f.target);var g=h.closest("tr.datagrid-row");if(!g.length){return}if(h.hasClass("tree-hit")){h.hasClass("tree-expanded")?h.removeClass("tree-expanded-hover"):h.removeClass("tree-collapsed-hover")}f.stopPropagation()}).unbind("click").bind("click",function(f){var h=U(f.target);var g=h.closest("tr.datagrid-row");if(!g.length){return}if(h.hasClass("tree-hit")){K(d,g.attr("node-id"))}else{a(f)}f.stopPropagation()})}function C(g,f){var c=U.data(g,"treegrid").options;var h=c.finder.getTr(g,f,"body",1);var b=c.finder.getTr(g,f,"body",2);var a=U(g).datagrid("getColumnFields",true).length+(c.rownumbers?1:0);var e=U(g).datagrid("getColumnFields",false).length;d(h,a);d(b,e);function d(j,i){U('<tr class="treegrid-tr-tree"><td style="border:0px" colspan="'+i+'"><div></div></td></tr>').insertAfter(j)}}function H(d,c,e,a){var n=U.data(d,"treegrid");var m=n.options;var f=n.dc;e=m.loadFilter.call(d,e,c);var j=I(d,c);if(j){var l=m.finder.getTr(d,c,"body",1);var k=m.finder.getTr(d,c,"body",2);var i=l.next("tr.treegrid-tr-tree").children("td").children("div");var b=k.next("tr.treegrid-tr-tree").children("td").children("div");if(!a){j.children=[]}}else{var i=f.body1;var b=f.body2;if(!a){n.data=[]}}if(!a){i.empty();b.empty()}if(m.view.onBeforeRender){m.view.onBeforeRender.call(m.view,d,c,e)}m.view.render.call(m.view,d,i,true);m.view.render.call(m.view,d,b,false);if(m.showFooter){m.view.renderFooter.call(m.view,d,f.footer1,true);m.view.renderFooter.call(m.view,d,f.footer2,false)}if(m.view.onAfterRender){m.view.onAfterRender.call(m.view,d)}m.onLoadSuccess.call(d,j,e);if(!c&&m.pagination){var h=U.data(d,"treegrid").total;var g=U(d).datagrid("getPager");if(g.pagination("options").total!=h){g.pagination({total:h})}}Q(d);V(d);U(d).treegrid("autoSizeColumn")}function T(g,f,j,i,a){var c=U.data(g,"treegrid").options;var b=U(g).datagrid("getPanel").find("div.datagrid-body");if(j){c.queryParams=j}var e=U.extend({},c.queryParams);if(c.pagination){U.extend(e,{page:c.pageNumber,rows:c.pageSize})}if(c.sortName){U.extend(e,{sort:c.sortName,order:c.sortOrder})}var h=I(g,f);if(c.onBeforeLoad.call(g,h,e)==false){return}var d=b.find('tr[node-id="'+f+'"] span.tree-folder');d.addClass("tree-loading");U(g).treegrid("loading");var k=c.loader.call(g,e,function(l){d.removeClass("tree-loading");U(g).treegrid("loaded");H(g,f,l,i);if(a){a()}},function(){d.removeClass("tree-loading");U(g).treegrid("loaded");c.onLoadError.apply(g,arguments);if(a){a()}});if(k==false){d.removeClass("tree-loading");U(g).treegrid("loaded")}}function X(b){var a=S(b);if(a.length){return a[0]}else{return null}}function S(a){return U.data(a,"treegrid").data}function W(b,c){var a=I(b,c);if(a._parentId){return I(b,a._parentId)}else{return null}}function N(d,g){var a=U.data(d,"treegrid").options;var h=U(d).datagrid("getPanel").find("div.datagrid-view2 div.datagrid-body");var e=[];if(g){b(g)}else{var f=S(d);for(var c=0;c<f.length;c++){e.push(f[c]);b(f[c][a.idField])}}function b(m){var l=I(d,m);if(l&&l.children){for(var j=0,n=l.children.length;j<n;j++){var k=l.children[j];e.push(k);b(k[a.idField])}}}return e}function B(a){var b=Z(a);if(b.length){return b[0]}else{return null}}function Z(b){var c=[];var a=U(b).datagrid("getPanel");a.find("div.datagrid-view2 div.datagrid-body tr.datagrid-row-selected").each(function(){var d=U(this).attr("node-id");c.push(I(b,d))});return c}function G(b,a){if(!a){return 0}var d=U.data(b,"treegrid").options;var c=U(b).datagrid("getPanel").children("div.datagrid-view");var e=c.find('div.datagrid-body tr[node-id="'+a+'"]').children('td[field="'+d.treeField+'"]');return e.find("span.tree-indent,span.tree-hit").length}function I(e,d){var g=U.data(e,"treegrid").options;var f=U.data(e,"treegrid").data;var a=[f];while(a.length){var j=a.shift();for(var h=0;h<j.length;h++){var b=j[h];if(b[g.idField]==d){return b}else{if(b["children"]){a.push(b["children"])}}}}return null}function F(e,d){var b=U.data(e,"treegrid").options;var f=I(e,d);var g=b.finder.getTr(e,d);var a=g.find("span.tree-hit");if(a.length==0){return}if(a.hasClass("tree-collapsed")){return}if(b.onBeforeCollapse.call(e,f)==false){return}a.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed");a.next().removeClass("tree-folder-open");f.state="closed";g=g.next("tr.treegrid-tr-tree");var c=g.children("td").children("div");if(b.animate){c.slideUp("normal",function(){U(e).treegrid("autoSizeColumn");Q(e,d);b.onCollapse.call(e,f)})}else{c.hide();U(e).treegrid("autoSizeColumn");Q(e,d);b.onCollapse.call(e,f)}}function P(i,a){var j=U.data(i,"treegrid").options;var d=j.finder.getTr(i,a);var c=d.find("span.tree-hit");var e=I(i,a);if(c.length==0){return}if(c.hasClass("tree-expanded")){return}if(j.onBeforeExpand.call(i,e)==false){return}c.removeClass("tree-collapsed tree-collapsed-hover").addClass("tree-expanded");c.next().addClass("tree-folder-open");var g=d.next("tr.treegrid-tr-tree");if(g.length){var b=g.children("td").children("div");f(b)}else{C(i,e[j.idField]);var g=d.next("tr.treegrid-tr-tree");var b=g.children("td").children("div");b.hide();var h=U.extend({},j.queryParams||{});h.id=e[j.idField];T(i,e[j.idField],h,true,function(){if(b.is(":empty")){g.remove()}else{f(b)}})}function f(k){e.state="open";if(j.animate){k.slideDown("normal",function(){U(i).treegrid("autoSizeColumn");Q(i,a);j.onExpand.call(i,e)})}else{k.show();U(i).treegrid("autoSizeColumn");Q(i,a);j.onExpand.call(i,e)}}}function K(a,e){var b=U.data(a,"treegrid").options;var c=b.finder.getTr(a,e);var d=c.find("span.tree-hit");if(d.hasClass("tree-expanded")){F(a,e)}else{P(a,e)}}function L(c,b){var e=U.data(c,"treegrid").options;var d=N(c,b);if(b){d.unshift(I(c,b))}for(var a=0;a<d.length;a++){F(c,d[a][e.idField])}}function J(c,e){var b=U.data(c,"treegrid").options;var d=N(c,e);if(e){d.unshift(I(c,e))}for(var a=0;a<d.length;a++){P(c,d[a][b.idField])}}function E(b,e){var c=U.data(b,"treegrid").options;var f=[];var d=W(b,e);while(d){var g=d[c.idField];f.unshift(g);d=W(b,g)}for(var a=0;a<f.length;a++){P(b,f[a])}}function Y(e,d){var a=U.data(e,"treegrid").options;if(d.parent){var c=a.finder.getTr(e,d.parent);if(c.next("tr.treegrid-tr-tree").length==0){C(e,d.parent)}var g=c.children('td[field="'+a.treeField+'"]').children("div.datagrid-cell");var b=g.children("span.tree-icon");if(b.hasClass("tree-file")){b.removeClass("tree-file").addClass("tree-folder tree-folder-open");var f=U('<span class="tree-hit tree-expanded"></span>').insertBefore(b);if(f.prev().length){f.prev().remove()}}}H(e,d.parent,d.data,true)}function M(b,a){var d=a.before||a.after;var e=U.data(b,"treegrid").options;var f=W(b,d);Y(b,{parent:(f?f[e.idField]:null),data:[a.data]});c(true);c(false);V(b);function c(k){var j=k?1:2;var h=e.finder.getTr(b,a.data[e.idField],"body",j);var l=h.closest("table.datagrid-btable");h=h.parent().children();var g=e.finder.getTr(b,d,"body",j);if(a.before){h.insertBefore(g)}else{var i=g.next("tr.treegrid-tr-tree");h.insertAfter(i.length?i:g)}l.remove()}}function O(c,b){var f=U.data(c,"treegrid").options;var d=f.finder.getTr(c,b);d.next("tr.treegrid-tr-tree").remove();d.remove();var e=a(b);if(e){if(e.children.length==0){d=f.finder.getTr(c,e[f.idField]);d.next("tr.treegrid-tr-tree").remove();var g=d.children('td[field="'+f.treeField+'"]').children("div.datagrid-cell");g.find(".tree-icon").removeClass("tree-folder").addClass("tree-file");g.find(".tree-hit").remove();U('<span class="tree-indent"></span>').prependTo(g)}}V(c);function a(l){var j;var k=W(c,b);if(k){j=k.children}else{j=U(c).treegrid("getData")}for(var h=0;h<j.length;h++){if(j[h][f.idField]==l){j.splice(h,1);break}}return k}}U.fn.treegrid=function(c,b){if(typeof c=="string"){var a=U.fn.treegrid.methods[c];if(a){return a(this,b)}else{return this.datagrid(c,b)}}c=c||{};return this.each(function(){var d=U.data(this,"treegrid");if(d){U.extend(d.options,c)}else{d=U.data(this,"treegrid",{options:U.extend({},U.fn.treegrid.defaults,U.fn.treegrid.parseOptions(this),c),data:[]})}D(this);if(d.options.data){U(this).treegrid("loadData",d.options.data)}T(this);A(this)})};U.fn.treegrid.methods={options:function(a){return U.data(a[0],"treegrid").options},resize:function(a,b){return a.each(function(){U(this).datagrid("resize",b)})},fixRowHeight:function(a,b){return a.each(function(){Q(this,b)})},loadData:function(a,b){return a.each(function(){H(this,b.parent,b)})},load:function(a,b){return a.each(function(){U(this).treegrid("options").pageNumber=1;U(this).treegrid("getPager").pagination({pageNumber:1});U(this).treegrid("reload",b)})},reload:function(a,b){return a.each(function(){var d=U(this).treegrid("options");var c={};if(typeof b=="object"){c=b}else{c=U.extend({},d.queryParams);c.id=b}if(c.id){var e=U(this).treegrid("find",c.id);if(e.children){e.children.splice(0,e.children.length)}d.queryParams=c;var f=d.finder.getTr(this,c.id);f.next("tr.treegrid-tr-tree").remove();f.find("span.tree-hit").removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed");P(this,c.id)}else{T(this,null,c)}})},reloadFooter:function(a,b){return a.each(function(){var c=U.data(this,"treegrid").options;var d=U.data(this,"datagrid").dc;if(b){U.data(this,"treegrid").footer=b}if(c.showFooter){c.view.renderFooter.call(c.view,this,d.footer1,true);c.view.renderFooter.call(c.view,this,d.footer2,false);if(c.view.onAfterRender){c.view.onAfterRender.call(c.view,this)}U(this).treegrid("fixRowHeight")}})},getData:function(a){return U.data(a[0],"treegrid").data},getFooterRows:function(a){return U.data(a[0],"treegrid").footer},getRoot:function(a){return X(a[0])},getRoots:function(a){return S(a[0])},getParent:function(a,b){return W(a[0],b)},getChildren:function(a,b){return N(a[0],b)},getSelected:function(a){return B(a[0])},getSelections:function(a){return Z(a[0])},getLevel:function(a,b){return G(a[0],b)},find:function(a,b){return I(a[0],b)},isLeaf:function(b,e){var d=U.data(b[0],"treegrid").options;var c=d.finder.getTr(b[0],e);var a=c.find("span.tree-hit");return a.length==0},select:function(a,b){return a.each(function(){U(this).datagrid("selectRow",b)})},unselect:function(a,b){return a.each(function(){U(this).datagrid("unselectRow",b)})},collapse:function(a,b){return a.each(function(){F(this,b)})},expand:function(a,b){return a.each(function(){P(this,b)})},toggle:function(a,b){return a.each(function(){K(this,b)})},collapseAll:function(a,b){return a.each(function(){L(this,b)})},expandAll:function(a,b){return a.each(function(){J(this,b)})},expandTo:function(a,b){return a.each(function(){E(this,b)})},append:function(a,b){return a.each(function(){Y(this,b)})},insert:function(a,b){return a.each(function(){M(this,b)})},remove:function(a,b){return a.each(function(){O(this,b)})},pop:function(a,c){var b=a.treegrid("find",c);a.treegrid("remove",c);return b},refresh:function(a,b){return a.each(function(){var c=U.data(this,"treegrid").options;c.view.refreshRow.call(c.view,this,b)})},update:function(b,a){return b.each(function(){var c=U.data(this,"treegrid").options;c.view.updateRow.call(c.view,this,a.id,a.row)})},beginEdit:function(a,b){return a.each(function(){U(this).datagrid("beginEdit",b);U(this).treegrid("fixRowHeight",b)})},endEdit:function(a,b){return a.each(function(){U(this).datagrid("endEdit",b)})},cancelEdit:function(a,b){return a.each(function(){U(this).datagrid("cancelEdit",b)})}};U.fn.treegrid.parseOptions=function(a){return U.extend({},U.fn.datagrid.parseOptions(a),U.parser.parseOptions(a,["treeField",{animate:"boolean"}]))};var R=U.extend({},U.fn.datagrid.defaults.view,{render:function(a,j,b){var g=U.data(a,"treegrid").options;var f=U(a).datagrid("getColumnFields",b);var i=U.data(a,"datagrid").rowIdPrefix;if(b){if(!(g.rownumbers||(g.frozenColumns&&g.frozenColumns.length))){return}}var h=0;var d=this;var c=e(b,this.treeLevel,this.treeNodes);U(j).append(c.join(""));function e(t,y,x){var k=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var u=0;u<x.length;u++){var w=x[u];if(w.state!="open"&&w.state!="closed"){w.state="open"}var q=g.rowStyler?g.rowStyler.call(a,w):"";var n="";var m="";if(typeof q=="string"){m=q}else{if(q){n=q["class"]||"";m=q["style"]||""}}var s='class="datagrid-row '+(h++%2&&g.striped?"datagrid-row-alt ":" ")+n+'"';var l=m?'style="'+m+'"':"";var o=i+"-"+(t?1:2)+"-"+w[g.idField];k.push('<tr id="'+o+'" node-id="'+w[g.idField]+'" '+s+" "+l+">");k=k.concat(d.renderRow.call(d,a,f,t,y,w));k.push("</tr>");if(w.children&&w.children.length){var p=e(t,y+1,w.children);var r=w.state=="closed"?"none":"block";k.push('<tr class="treegrid-tr-tree"><td style="border:0px" colspan='+(f.length+(g.rownumbers?1:0))+'><div style="display:'+r+'">');k=k.concat(p);k.push("</div></td></tr>")}}k.push("</tbody></table>");return k}},renderFooter:function(j,d,c){var f=U.data(j,"treegrid").options;var e=U.data(j,"treegrid").footer||[];var b=U(j).datagrid("getColumnFields",c);var a=['<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var h=0;h<e.length;h++){var g=e[h];g[f.idField]=g[f.idField]||("foot-row-id"+h);a.push('<tr class="datagrid-row" node-id="'+g[f.idField]+'">');a.push(this.renderRow.call(this,j,b,c,0,g));a.push("</tr>")}a.push("</tbody></table>");U(d).html(a.join(""))},renderRow:function(b,a,f,e,n){var k=U.data(b,"treegrid").options;var o=[];if(f&&k.rownumbers){o.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">0</div></td>')}for(var d=0;d<a.length;d++){var m=a[d];var s=U(b).datagrid("getColumnOption",m);if(s){var q=s.styler?(s.styler(n[m],n)||""):"";var l="";var h="";if(typeof q=="string"){h=q}else{if(o){l=q["class"]||"";h=q["style"]||""}}var c=l?'class="'+l+'"':"";var g=s.hidden?'style="display:none;'+h+'"':(h?'style="'+h+'"':"");o.push('<td field="'+m+'" '+c+" "+g+">");if(s.checkbox){var g=""}else{var g=h;if(s.align){g+=";text-align:"+s.align+";"}if(!k.nowrap){g+=";white-space:normal;height:auto;"}else{if(k.autoRowHeight){g+=";height:auto;"}}}o.push('<div style="'+g+'" ');if(s.checkbox){o.push('class="datagrid-cell-check ')}else{o.push('class="datagrid-cell '+s.cellClass)}o.push('">');if(s.checkbox){if(n.checked){o.push('<input type="checkbox" checked="checked"')}else{o.push('<input type="checkbox"')}o.push(' name="'+m+'" value="'+(n[m]!=undefined?n[m]:"")+'"/>')}else{var p=null;if(s.formatter){p=s.formatter(n[m],n)}else{p=n[m]}if(m==k.treeField){for(var r=0;r<e;r++){o.push('<span class="tree-indent"></span>')}if(n.state=="closed"){o.push('<span class="tree-hit tree-collapsed"></span>');o.push('<span class="tree-icon tree-folder '+(n.iconCls?n.iconCls:"")+'"></span>')}else{if(n.children&&n.children.length){o.push('<span class="tree-hit tree-expanded"></span>');o.push('<span class="tree-icon tree-folder tree-folder-open '+(n.iconCls?n.iconCls:"")+'"></span>')}else{o.push('<span class="tree-indent"></span>');o.push('<span class="tree-icon tree-file '+(n.iconCls?n.iconCls:"")+'"></span>')}}o.push('<span class="tree-title">'+p+"</span>")}else{o.push(p)}}o.push("</div>");o.push("</td>")}}return o.join("")},refreshRow:function(a,b){this.updateRow.call(this,a,b,{})},updateRow:function(d,h,g){var c=U.data(d,"treegrid").options;var f=U(d).treegrid("find",h);U.extend(f,g);var e=U(d).treegrid("getLevel",h)-1;var b=c.rowStyler?c.rowStyler.call(d,f):"";function a(m){var l=U(d).treegrid("getColumnFields",m);var i=c.finder.getTr(d,h,"body",(m?1:2));var j=i.find("div.datagrid-cell-rownumber").html();var k=i.find("div.datagrid-cell-check input[type=checkbox]").is(":checked");i.html(this.renderRow(d,l,m,e,f));i.attr("style",b||"");i.find("div.datagrid-cell-rownumber").html(j);if(k){i.find("div.datagrid-cell-check input[type=checkbox]")._propAttr("checked",true)}}a.call(this,true);a.call(this,false);U(d).treegrid("fixRowHeight",h)},onBeforeRender:function(e,g,f){if(U.isArray(g)){f={total:g.length,rows:g};g=null}if(!f){return false}var b=U.data(e,"treegrid");var a=b.options;if(f.length==undefined){if(f.footer){b.footer=f.footer}if(f.total){b.total=f.total}f=this.transfer(e,g,f.rows)}else{function d(k,j){for(var h=0;h<k.length;h++){var l=k[h];l._parentId=j;if(l.children&&l.children.length){d(l.children,l[a.idField])}}}d(f,g)}var c=I(e,g);if(c){if(c.children){c.children=c.children.concat(f)}else{c.children=f}}else{b.data=b.data.concat(f)}this.sort(e,f);this.treeNodes=f;this.treeLevel=U(e).treegrid("getLevel",g)},sort:function(c,f){var e=U.data(c,"treegrid").options;if(!e.remoteSort&&e.sortName){var b=e.sortName.split(",");var a=e.sortOrder.split(",");d(f)}function d(j){j.sort(function(l,n){var k=0;for(var m=0;m<b.length;m++){var p=b[m];var o=a[m];var s=U(c).treegrid("getColumnOption",p);var q=s.sorter||function(r,i){return r==i?0:(r>i?1:-1)};k=q(l[p],n[p])*(o=="asc"?1:-1);if(k!=0){return k}}return k});for(var g=0;g<j.length;g++){var h=j[g].children;if(h&&h.length){d(h)}}}},transfer:function(k,h,g){var j=U.data(k,"treegrid").options;var a=[];for(var c=0;c<g.length;c++){a.push(g[c])}var b=[];for(var c=0;c<a.length;c++){var d=a[c];if(!h){if(!d._parentId){b.push(d);a.splice(c,1);c--}}else{if(d._parentId==h){b.push(d);a.splice(c,1);c--}}}var f=[];for(var c=0;c<b.length;c++){f.push(b[c])}while(f.length){var e=f.shift();for(var c=0;c<a.length;c++){var d=a[c];if(d._parentId==e[j.idField]){if(e.children){e.children.push(d)}else{e.children=[d]}f.push(d);a.splice(c,1);c--}}}return b}});U.fn.treegrid.defaults=U.extend({},U.fn.datagrid.defaults,{treeField:null,animate:false,singleSelect:true,view:R,loader:function(a,d,c){var b=U(this).treegrid("options");if(!b.url){return false}U.ajax({type:b.method,url:b.url,data:a,dataType:"json",success:function(e){d(e)},error:function(){c.apply(this,arguments)}})},loadFilter:function(b,a){return b},finder:{getTr:function(i,f,h,a){h=h||"body";a=a||0;var b=U.data(i,"datagrid").dc;if(a==0){var d=U.data(i,"treegrid").options;var e=d.finder.getTr(i,f,h,1);var c=d.finder.getTr(i,f,h,2);return e.add(c)}else{if(h=="body"){var g=U("#"+U.data(i,"datagrid").rowIdPrefix+"-"+a+"-"+f);if(!g.length){g=(a==1?b.body1:b.body2).find('tr[node-id="'+f+'"]')}return g}else{if(h=="footer"){return(a==1?b.footer1:b.footer2).find('tr[node-id="'+f+'"]')}else{if(h=="selected"){return(a==1?b.body1:b.body2).find("tr.datagrid-row-selected")}else{if(h=="highlight"){return(a==1?b.body1:b.body2).find("tr.datagrid-row-over")}else{if(h=="checked"){return(a==1?b.body1:b.body2).find("tr.datagrid-row-checked")}else{if(h=="last"){return(a==1?b.body1:b.body2).find("tr:last[node-id]")}else{if(h=="allbody"){return(a==1?b.body1:b.body2).find("tr[node-id]")}else{if(h=="allfooter"){return(a==1?b.footer1:b.footer2).find("tr[node-id]")}}}}}}}}}},getRow:function(b,a){var c=(typeof a=="object")?a.attr("node-id"):a;return U(b).treegrid("find",c)}},onBeforeLoad:function(b,a){},onLoadSuccess:function(a,b){},onLoadError:function(){},onBeforeCollapse:function(a){},onCollapse:function(a){},onBeforeExpand:function(a){},onExpand:function(a){},onClickRow:function(a){},onDblClickRow:function(a){},onClickCell:function(a,b){},onDblClickCell:function(b,a){},onContextMenu:function(a,b){},onBeforeEdit:function(a){},onAfterEdit:function(b,a){},onCancelEdit:function(a){}})})(jQuery);