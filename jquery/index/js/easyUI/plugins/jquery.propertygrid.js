(function(E){var B;function C(G){var H=E.data(G,"propertygrid");var F=E.data(G,"propertygrid").options;E(G).datagrid(E.extend({},F,{cls:"propertygrid",view:(F.showGroup?F.groupView:F.view),onClickRow:function(I,J){if(B!=this){A(B);B=this}if(F.editIndex!=I&&J.editor){var K=E(this).datagrid("getColumnOption","value");K.editor=J.editor;A(B);E(this).datagrid("beginEdit",I);E(this).datagrid("getEditors",I)[0].target.focus();F.editIndex=I}F.onClickRow.call(G,I,J)},loadFilter:function(I){A(this);return F.loadFilter.call(this,I)}}));E(document).unbind(".propertygrid").bind("mousedown.propertygrid",function(I){var J=E(I.target).closest("div.datagrid-view,div.combo-panel");if(J.length){return}A(B);B=undefined})}function A(G){var I=E(G);if(!I.length){return}var H=E.data(G,"propertygrid").options;var J=H.editIndex;if(J==undefined){return}var F=I.datagrid("getEditors",J)[0];if(F){F.target.blur();if(I.datagrid("validateRow",J)){I.datagrid("endEdit",J)}else{I.datagrid("cancelEdit",J)}}H.editIndex=undefined}E.fn.propertygrid=function(H,G){if(typeof H=="string"){var F=E.fn.propertygrid.methods[H];if(F){return F(this,G)}else{return this.datagrid(H,G)}}H=H||{};return this.each(function(){var I=E.data(this,"propertygrid");if(I){E.extend(I.options,H)}else{var J=E.extend({},E.fn.propertygrid.defaults,E.fn.propertygrid.parseOptions(this),H);J.frozenColumns=E.extend(true,[],J.frozenColumns);J.columns=E.extend(true,[],J.columns);E.data(this,"propertygrid",{options:J})}C(this)})};E.fn.propertygrid.methods={options:function(F){return E.data(F[0],"propertygrid").options}};E.fn.propertygrid.parseOptions=function(F){return E.extend({},E.fn.datagrid.parseOptions(F),E.parser.parseOptions(F,[{showGroup:"boolean"}]))};var D=E.extend({},E.fn.datagrid.defaults.view,{render:function(I,F,K){var J=[];var H=this.groups;for(var G=0;G<H.length;G++){J.push(this.renderGroup.call(this,I,G,H[G],K))}E(F).html(J.join(""))},renderGroup:function(H,J,I,F){var U=E.data(H,"datagrid");var G=U.options;var R=E(H).datagrid("getColumnFields",F);var Q=[];Q.push('<div class="datagrid-group" group-index='+J+">");Q.push('<table cellspacing="0" cellpadding="0" border="0" style="height:100%"><tbody>');Q.push("<tr>");if((F&&(G.rownumbers||G.frozenColumns.length))||(!F&&!(G.rownumbers||G.frozenColumns.length))){Q.push('<td style="border:0;text-align:center;width:25px"><span class="datagrid-row-expander datagrid-row-collapse" style="display:inline-block;width:16px;height:16px;cursor:pointer">&nbsp;</span></td>')}Q.push('<td style="border:0;">');if(!F){Q.push('<span class="datagrid-group-title">');Q.push(G.groupFormatter.call(H,I.value,I.rows));Q.push("</span>")}Q.push("</td>");Q.push("</tr>");Q.push("</tbody></table>");Q.push("</div>");Q.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');var T=I.startIndex;for(var L=0;L<I.rows.length;L++){var K=G.rowStyler?G.rowStyler.call(H,T,I.rows[L]):"";var S="";var O="";if(typeof K=="string"){O=K}else{if(K){S=K["class"]||"";O=K["style"]||""}}var M='class="datagrid-row '+(T%2&&G.striped?"datagrid-row-alt ":" ")+S+'"';var N=O?'style="'+O+'"':"";var P=U.rowIdPrefix+"-"+(F?1:2)+"-"+T;Q.push('<tr id="'+P+'" datagrid-row-index="'+T+'" '+M+" "+N+">");Q.push(this.renderRow.call(this,H,R,F,T,I.rows[L]));Q.push("</tr>");T++}Q.push("</tbody></table>");return Q.join("")},bindEvents:function(H){var F=E.data(H,"datagrid");var I=F.dc;var G=I.body1.add(I.body2);var J=(E.data(G[0],"events")||E._data(G[0],"events")).click[0].handler;G.unbind("click").bind("click",function(K){var N=E(K.target);var M=N.closest("span.datagrid-row-expander");if(M.length){var L=M.closest("div.datagrid-group").attr("group-index");if(M.hasClass("datagrid-row-collapse")){E(H).datagrid("collapseGroup",L)}else{E(H).datagrid("expandGroup",L)}}else{J(K)}K.stopPropagation()})},onBeforeRender:function(G,F){var H=E.data(G,"datagrid");var P=H.options;O();var R=[];for(var L=0;L<F.length;L++){var M=F[L];var Q=I(M[P.groupField]);if(!Q){Q={value:M[P.groupField],rows:[M]};R.push(Q)}else{Q.rows.push(M)}}var K=0;var N=[];for(var L=0;L<R.length;L++){var Q=R[L];Q.startIndex=K;K+=Q.rows.length;N=N.concat(Q.rows)}H.data.rows=N;this.groups=R;var J=this;setTimeout(function(){J.bindEvents(G)},0);function I(U){for(var S=0;S<R.length;S++){var T=R[S];if(T.value==U){return T}}return null}function O(){if(!E("#datagrid-group-style").length){E("head").append('<style id="datagrid-group-style">.datagrid-group{height:25px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;}</style>')}}}});E.extend(E.fn.datagrid.methods,{expandGroup:function(F,G){return F.each(function(){var J=E.data(this,"datagrid").dc.view;var I=J.find(G!=undefined?'div.datagrid-group[group-index="'+G+'"]':"div.datagrid-group");var H=I.find("span.datagrid-row-expander");if(H.hasClass("datagrid-row-expand")){H.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");I.next("table").show()}E(this).datagrid("fixRowHeight")})},collapseGroup:function(F,G){return F.each(function(){var H=E.data(this,"datagrid").dc.view;var J=H.find(G!=undefined?'div.datagrid-group[group-index="'+G+'"]':"div.datagrid-group");var I=J.find("span.datagrid-row-expander");if(I.hasClass("datagrid-row-collapse")){I.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");J.next("table").hide()}E(this).datagrid("fixRowHeight")})}});E.fn.propertygrid.defaults=E.extend({},E.fn.datagrid.defaults,{singleSelect:true,remoteSort:false,fitColumns:true,loadMsg:"",frozenColumns:[[{field:"f",width:16,resizable:false}]],columns:[[{field:"name",title:"Name",width:100,sortable:true},{field:"value",title:"Value",width:100,resizable:false}]],showGroup:false,groupView:D,groupField:"group",groupFormatter:function(G,F){return G}})})(jQuery);