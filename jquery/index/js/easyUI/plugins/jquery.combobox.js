(function(I){function L(P,R,S,N){var O=I.data(P,"combobox");var Q=O.options;if(N){return T(O.groups,S,R)}else{return T(O.data,(S?S:O.options.valueField),R)}function T(W,U,Y){for(var V=0;V<W.length;V++){var X=W[V];if(X[U]==Y){return X}}return null}}function G(S,P){var O=I(S).combo("panel");var R=L(S,P);if(R){var N=I("#"+R.domId);if(N.position().top<=0){var Q=O.scrollTop()+N.position().top;O.scrollTop(Q)}else{if(N.position().top+N.outerHeight()>O.height()){var Q=O.scrollTop()+N.position().top+N.outerHeight()-O.height();O.scrollTop(Q)}}}}function H(T,N){var S=I.data(T,"combobox").options;var P=I(T).combobox("panel");var O=P.children("div.combobox-item-hover");if(!O.length){O=P.children("div.combobox-item-selected")}O.removeClass("combobox-item-hover");var R="div.combobox-item:visible:not(.combobox-item-disabled):first";var Q="div.combobox-item:visible:not(.combobox-item-disabled):last";if(!O.length){O=P.children(N=="next"?R:Q)}else{if(N=="next"){O=O.nextAll(R);if(!O.length){O=P.children(R)}}else{O=O.prevAll(R);if(!O.length){O=P.children(Q)}}}if(O.length){O.addClass("combobox-item-hover");var U=L(T,O.attr("id"),"domId");if(U){G(T,U[S.valueField]);if(S.selectOnNavigation){A(T,U[S.valueField])}}}}function A(Q,P){var O=I.data(Q,"combobox").options;var N=I(Q).combo("getValues");if(I.inArray(P+"",N)==-1){if(O.multiple){N.push(P)}else{N=[P]}B(Q,N);O.onSelect.call(Q,L(Q,P))}}function M(R,O){var N=I.data(R,"combobox").options;var Q=I(R).combo("getValues");var P=I.inArray(O+"",Q);if(P>=0){Q.splice(P,1);B(R,Q);N.onUnselect.call(R,L(R,O))}}function B(V,U,X){var W=I.data(V,"combobox").options;var O=I(V).combo("panel");O.find("div.combobox-item-selected").removeClass("combobox-item-selected");var R=[],Q=[];for(var S=0;S<U.length;S++){var P=U[S];var N=P;var T=L(V,P);if(T){N=T[W.textField];I("#"+T.domId).addClass("combobox-item-selected")}R.push(P);Q.push(N)}I(V).combo("setValues",R);if(!X){I(V).combo("setText",Q.join(W.separator))}}var C=1;function E(T,S,Z){var O=I.data(T,"combobox");var R=O.options;O.data=R.loadFilter.call(T,S);O.groups=[];S=O.data;var X=I(T).combobox("getValues");var P=[];var W=undefined;for(var U=0;U<S.length;U++){var V=S[U];var Q=V[R.valueField]+"";var N=V[R.textField];var b=V[R.groupField];if(b){if(W!=b){W=b;var Y={value:b,domId:("_easyui_combobox_"+C++)};O.groups.push(Y);P.push('<div id="'+Y.domId+'" class="combobox-group">');P.push(R.groupFormatter?R.groupFormatter.call(T,b):b);P.push("</div>")}}else{W=undefined}var a="combobox-item"+(V.disabled?" combobox-item-disabled":"")+(b?" combobox-gitem":"");V.domId="_easyui_combobox_"+C++;P.push('<div id="'+V.domId+'" class="'+a+'">');P.push(R.formatter?R.formatter.call(T,V):N);P.push("</div>");if(V["selected"]&&I.inArray(Q,X)==-1){X.push(Q)}}I(T).combo("panel").html(P.join(""));if(R.multiple){B(T,X,Z)}else{B(T,X.length?[X[X.length-1]]:[],Z)}R.onLoadSuccess.call(T,S)}function F(O,N,R,Q){var P=I.data(O,"combobox").options;if(N){P.url=N}R=R||{};if(P.onBeforeLoad.call(O,R)==false){return}P.loader.call(O,R,function(S){E(O,S,Q)},function(){P.onLoadError.apply(this,arguments)})}function K(Y,Q){var T=I.data(Y,"combobox");var S=T.options;if(S.multiple&&!Q){B(Y,[],true)}else{B(Y,[Q],true)}if(S.mode=="remote"){F(Y,null,{q:Q},true)}else{var N=I(Y).combo("panel");N.find("div.combobox-item,div.combobox-group").hide();var a=T.data;var P=undefined;for(var V=0;V<a.length;V++){var W=a[V];if(S.filter.call(Y,Q,W)){var R=W[S.valueField];var O=W[S.textField];var Z=W[S.groupField];var X=I("#"+W.domId).show();if(O.toLowerCase()==Q.toLowerCase()){B(Y,[R]);X.addClass("combobox-item-selected")}if(S.groupField&&P!=Z){var U=L(Y,Z,"value",true);if(U){I("#"+U.domId).show()}P=Z}}}}}function D(U){var N=I(U);var P=N.combobox("options");var O=N.combobox("panel");var R=O.children("div.combobox-item-hover");if(!R.length){R=O.children("div.combobox-item-selected")}if(!R.length){return}var T=L(U,R.attr("id"),"domId");if(!T){return}var Q=T[P.valueField];if(P.multiple){if(R.hasClass("combobox-item-selected")){N.combobox("unselect",Q)}else{N.combobox("select",Q)}}else{N.combobox("select",Q);N.combobox("hidePanel")}var S=[];var W=N.combobox("getValues");for(var V=0;V<W.length;V++){if(L(U,W[V])){S.push(W[V])}}N.combobox("setValues",S)}function J(N){var O=I.data(N,"combobox").options;I(N).addClass("combobox-f");I(N).combo(I.extend({},O,{onShowPanel:function(){I(N).combo("panel").find("div.combobox-item,div.combobox-group").show();G(N,I(N).combobox("getValue"));O.onShowPanel.call(N)}}));I(N).combo("panel").unbind().bind("mouseover",function(P){I(this).children("div.combobox-item-hover").removeClass("combobox-item-hover");var Q=I(P.target).closest("div.combobox-item");if(!Q.hasClass("combobox-item-disabled")){Q.addClass("combobox-item-hover")}P.stopPropagation()}).bind("mouseout",function(P){I(P.target).closest("div.combobox-item").removeClass("combobox-item-hover");P.stopPropagation()}).bind("click",function(Q){var R=I(Q.target).closest("div.combobox-item");if(!R.length||R.hasClass("combobox-item-disabled")){return}var S=L(N,R.attr("id"),"domId");if(!S){return}var P=S[O.valueField];if(O.multiple){if(R.hasClass("combobox-item-selected")){M(N,P)}else{A(N,P)}}else{A(N,P);I(N).combo("hidePanel")}Q.stopPropagation()})}I.fn.combobox=function(P,O){if(typeof P=="string"){var N=I.fn.combobox.methods[P];if(N){return N(this,O)}else{return this.combo(P,O)}}P=P||{};return this.each(function(){var R=I.data(this,"combobox");if(R){I.extend(R.options,P);J(this)}else{R=I.data(this,"combobox",{options:I.extend({},I.fn.combobox.defaults,I.fn.combobox.parseOptions(this),P),data:[]});J(this);var Q=I.fn.combobox.parseData(this);if(Q.length){E(this,Q)}}if(R.options.data){E(this,R.options.data)}F(this)})};I.fn.combobox.methods={options:function(N){var O=N.combo("options");return I.extend(I.data(N[0],"combobox").options,{originalValue:O.originalValue,disabled:O.disabled,readonly:O.readonly})},getData:function(N){return I.data(N[0],"combobox").data},setValues:function(N,O){return N.each(function(){B(this,O)})},setValue:function(N,O){return N.each(function(){B(this,[O])})},clear:function(N){return N.each(function(){I(this).combo("clear");var O=I(this).combo("panel");O.find("div.combobox-item-selected").removeClass("combobox-item-selected")})},reset:function(N){return N.each(function(){var O=I(this).combobox("options");if(O.multiple){I(this).combobox("setValues",O.originalValue)}else{I(this).combobox("setValue",O.originalValue)}})},loadData:function(N,O){return N.each(function(){E(this,O)})},reload:function(N,O){return N.each(function(){F(this,O)})},select:function(N,O){return N.each(function(){A(this,O)})},unselect:function(O,N){return O.each(function(){M(this,N)})}};I.fn.combobox.parseOptions=function(O){var N=I(O);return I.extend({},I.fn.combo.parseOptions(O),I.parser.parseOptions(O,["valueField","textField","groupField","mode","method","url"]))};I.fn.combobox.parseData=function(P){var O=[];var Q=I(P).combobox("options");I(P).children().each(function(){if(this.tagName.toLowerCase()=="optgroup"){var R=I(this).attr("label");I(this).children().each(function(){N(this,R)})}else{N(this)}});return O;function N(R,T){var U=I(R);var S={};S[Q.valueField]=U.attr("value")!=undefined?U.attr("value"):U.html();S[Q.textField]=U.html();S["selected"]=U.is(":selected");S["disabled"]=U.is(":disabled");if(T){Q.groupField=Q.groupField||"group";S[Q.groupField]=T}O.push(S)}};I.fn.combobox.defaults=I.extend({},I.fn.combo.defaults,{valueField:"value",textField:"text",groupField:null,groupFormatter:function(N){return N},mode:"local",method:"post",url:null,data:null,keyHandler:{up:function(N){H(this,"prev");N.preventDefault()},down:function(N){H(this,"next");N.preventDefault()},left:function(N){},right:function(N){},enter:function(N){D(this)},query:function(O,N){K(this,O)}},filter:function(O,P){var N=I(this).combobox("options");return P[N.textField].toLowerCase().indexOf(O.toLowerCase())==0},formatter:function(N){var O=I(this).combobox("options");return N[O.textField]},loader:function(P,O,Q){var N=I(this).combobox("options");if(!N.url){return false}I.ajax({type:N.method,url:N.url,data:P,dataType:"json",success:function(R){O(R)},error:function(){Q.apply(this,arguments)}})},loadFilter:function(N){return N},onBeforeLoad:function(N){},onLoadSuccess:function(){},onLoadError:function(){},onSelect:function(N){},onUnselect:function(N){}})})(jQuery);