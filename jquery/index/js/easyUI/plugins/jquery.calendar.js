(function(F){function H(I){var J=F.data(I,"calendar").options;var K=F(I);J.fit?F.extend(J,K._fit()):K._fit(false);var L=K.find(".calendar-header");K._outerWidth(J.width);K._outerHeight(J.height);K.find(".calendar-body")._outerHeight(K.height()-L._outerHeight())}function D(I){F(I).addClass("calendar").html('<div class="calendar-header"><div class="calendar-prevmonth"></div><div class="calendar-nextmonth"></div><div class="calendar-prevyear"></div><div class="calendar-nextyear"></div><div class="calendar-title"><span>Aprial 2010</span></div></div><div class="calendar-body"><div class="calendar-menu"><div class="calendar-menu-year-inner"><span class="calendar-menu-prev"></span><span><input class="calendar-menu-year" type="text"></input></span><span class="calendar-menu-next"></span></div><div class="calendar-menu-month-inner"></div></div></div>');F(I).find(".calendar-title span").hover(function(){F(this).addClass("calendar-menu-hover")},function(){F(this).removeClass("calendar-menu-hover")}).click(function(){var J=F(I).find(".calendar-menu");if(J.is(":visible")){J.hide()}else{C(I)}});F(".calendar-prevmonth,.calendar-nextmonth,.calendar-prevyear,.calendar-nextyear",I).hover(function(){F(this).addClass("calendar-nav-hover")},function(){F(this).removeClass("calendar-nav-hover")});F(I).find(".calendar-nextmonth").click(function(){B(I,1)});F(I).find(".calendar-prevmonth").click(function(){B(I,-1)});F(I).find(".calendar-nextyear").click(function(){E(I,1)});F(I).find(".calendar-prevyear").click(function(){E(I,-1)});F(I).bind("_resize",function(){var J=F.data(I,"calendar").options;if(J.fit==true){H(I)}return false})}function B(I,J){var K=F.data(I,"calendar").options;K.month+=J;if(K.month>12){K.year++;K.month=1}else{if(K.month<1){K.year--;K.month=12}}A(I);var L=F(I).find(".calendar-menu-month-inner");L.find("td.calendar-selected").removeClass("calendar-selected");L.find("td:eq("+(K.month-1)+")").addClass("calendar-selected")}function E(J,I){var L=F.data(J,"calendar").options;L.year+=I;A(J);var K=F(J).find(".calendar-menu-year");K.val(L.year)}function C(O){var R=F.data(O,"calendar").options;F(O).find(".calendar-menu").show();if(F(O).find(".calendar-menu-month-inner").is(":empty")){F(O).find(".calendar-menu-month-inner").empty();var M=F("<table></table>").appendTo(F(O).find(".calendar-menu-month-inner"));var K=0;for(var P=0;P<3;P++){var S=F("<tr></tr>").appendTo(M);for(var N=0;N<4;N++){F('<td class="calendar-menu-month"></td>').html(R.months[K++]).attr("abbr",K).appendTo(S)}}F(O).find(".calendar-menu-prev,.calendar-menu-next").hover(function(){F(this).addClass("calendar-menu-hover")},function(){F(this).removeClass("calendar-menu-hover")});F(O).find(".calendar-menu-next").click(function(){var U=F(O).find(".calendar-menu-year");if(!isNaN(U.val())){U.val(parseInt(U.val())+1)}});F(O).find(".calendar-menu-prev").click(function(){var U=F(O).find(".calendar-menu-year");if(!isNaN(U.val())){U.val(parseInt(U.val()-1))}});F(O).find(".calendar-menu-year").keypress(function(U){if(U.keyCode==13){Q()}});F(O).find(".calendar-menu-month").hover(function(){F(this).addClass("calendar-menu-hover")},function(){F(this).removeClass("calendar-menu-hover")}).click(function(){var U=F(O).find(".calendar-menu");U.find(".calendar-selected").removeClass("calendar-selected");F(this).addClass("calendar-selected");Q()})}function Q(){var W=F(O).find(".calendar-menu");var V=W.find(".calendar-menu-year").val();var U=W.find(".calendar-selected").attr("abbr");if(!isNaN(V)){R.year=parseInt(V);R.month=parseInt(U);A(O)}W.hide()}var L=F(O).find(".calendar-body");var I=F(O).find(".calendar-menu");var T=I.find(".calendar-menu-year-inner");var J=I.find(".calendar-menu-month-inner");T.find("input").val(R.year).focus();J.find("td.calendar-selected").removeClass("calendar-selected");J.find("td:eq("+(R.month-1)+")").addClass("calendar-selected");I._outerWidth(L._outerWidth());I._outerHeight(L._outerHeight());J._outerHeight(I.height()-T._outerHeight())}function G(U,X,W){var R=F.data(U,"calendar").options;var Q=[];var T=new Date(X,W,0).getDate();for(var O=1;O<=T;O++){Q.push([X,W,O])}var S=[],J=[];var I=-1;while(Q.length>0){var L=Q.shift();J.push(L);var N=new Date(L[0],L[1]-1,L[2]).getDay();if(I==N){N=0}else{if(N==(R.firstDay==0?7:R.firstDay)-1){S.push(J);J=[]}}I=N}if(J.length){S.push(J)}var V=S[0];if(V.length<7){while(V.length<7){var M=V[0];var L=new Date(M[0],M[1]-1,M[2]-1);V.unshift([L.getFullYear(),L.getMonth()+1,L.getDate()])}}else{var M=V[0];var J=[];for(var O=1;O<=7;O++){var L=new Date(M[0],M[1]-1,M[2]-O);J.unshift([L.getFullYear(),L.getMonth()+1,L.getDate()])}S.unshift(J)}var P=S[S.length-1];while(P.length<7){var K=P[P.length-1];var L=new Date(K[0],K[1]-1,K[2]+1);P.push([L.getFullYear(),L.getMonth()+1,L.getDate()])}if(S.length<6){var K=P[P.length-1];var J=[];for(var O=1;O<=7;O++){var L=new Date(K[0],K[1]-1,K[2]+O);J.push([L.getFullYear(),L.getMonth()+1,L.getDate()])}S.push(J)}return S}function A(J){var T=F.data(J,"calendar").options;F(J).find(".calendar-title span").html(T.months[T.month-1]+" "+T.year);var S=F(J).find("div.calendar-body");S.find(">table").remove();var K=F('<table cellspacing="0" cellpadding="0" border="0"><thead></thead><tbody></tbody></table>').prependTo(S);var W=F("<tr></tr>").appendTo(K.find("thead"));for(var P=T.firstDay;P<T.weeks.length;P++){W.append("<th>"+T.weeks[P]+"</th>")}for(var P=0;P<T.firstDay;P++){W.append("<th>"+T.weeks[P]+"</th>")}var V=G(J,T.year,T.month);for(var P=0;P<V.length;P++){var U=V[P];var W=F("<tr></tr>").appendTo(K.find("tbody"));for(var M=0;M<U.length;M++){var N=U[M];F('<td class="calendar-day calendar-other-month"></td>').attr("abbr",N[0]+","+N[1]+","+N[2]).html(N[2]).appendTo(W)}}K.find('td[abbr^="'+T.year+","+T.month+'"]').removeClass("calendar-other-month");var I=new Date();var O=I.getFullYear()+","+(I.getMonth()+1)+","+I.getDate();K.find('td[abbr="'+O+'"]').addClass("calendar-today");if(T.current){K.find(".calendar-selected").removeClass("calendar-selected");var L=T.current.getFullYear()+","+(T.current.getMonth()+1)+","+T.current.getDate();K.find('td[abbr="'+L+'"]').addClass("calendar-selected")}var R=6-T.firstDay;var Q=R+1;if(R>=7){R-=7}if(Q>=7){Q-=7}K.find("tr").find("td:eq("+R+")").addClass("calendar-saturday");K.find("tr").find("td:eq("+Q+")").addClass("calendar-sunday");K.find("td").hover(function(){F(this).addClass("calendar-hover")},function(){F(this).removeClass("calendar-hover")}).click(function(){K.find(".calendar-selected").removeClass("calendar-selected");F(this).addClass("calendar-selected");var X=F(this).attr("abbr").split(",");T.current=new Date(X[0],parseInt(X[1])-1,X[2]);T.onSelect.call(J,T.current)})}F.fn.calendar=function(I,J){if(typeof I=="string"){return F.fn.calendar.methods[I](this,J)}I=I||{};return this.each(function(){var K=F.data(this,"calendar");if(K){F.extend(K.options,I)}else{K=F.data(this,"calendar",{options:F.extend({},F.fn.calendar.defaults,F.fn.calendar.parseOptions(this),I)});D(this)}if(K.options.border==false){F(this).addClass("calendar-noborder")}H(this);A(this);F(this).find("div.calendar-menu").hide()})};F.fn.calendar.methods={options:function(I){return F.data(I[0],"calendar").options},resize:function(I){return I.each(function(){H(this)})},moveTo:function(I,J){return I.each(function(){F(this).calendar({year:J.getFullYear(),month:J.getMonth()+1,current:J})})}};F.fn.calendar.parseOptions=function(I){var J=F(I);return F.extend({},F.parser.parseOptions(I,["width","height",{firstDay:"number",fit:"boolean",border:"boolean"}]))};F.fn.calendar.defaults={width:180,height:180,fit:false,border:true,firstDay:0,weeks:["S","M","T","W","T","F","S"],months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:new Date().getFullYear(),month:new Date().getMonth()+1,current:new Date(),onSelect:function(I){}}})(jQuery);