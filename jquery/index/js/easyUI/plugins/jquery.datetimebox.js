(function(F){function B(H){var J=F.data(H,"datetimebox");var K=J.options;F(H).datebox(F.extend({},K,{onShowPanel:function(){var L=F(H).datetimebox("getValue");E(H,L,true);K.onShowPanel.call(H)},formatter:F.fn.datebox.defaults.formatter,parser:F.fn.datebox.defaults.parser}));F(H).removeClass("datebox-f").addClass("datetimebox-f");F(H).datebox("calendar").calendar({onSelect:function(L){K.onSelect.call(H,L)}});var I=F(H).datebox("panel");if(!J.spinner){var G=F('<div style="padding:2px"><input style="width:80px"></div>').insertAfter(I.children("div.datebox-calendar-inner"));J.spinner=G.children("input")}J.spinner.timespinner({showSeconds:K.showSeconds,separator:K.timeSeparator}).unbind(".datetimebox").bind("mousedown.datetimebox",function(L){L.stopPropagation()});E(H,K.value)}function C(G){var I=F(G).datetimebox("calendar");var J=F(G).datetimebox("spinner");var H=I.calendar("options").current;return new Date(H.getFullYear(),H.getMonth(),H.getDate(),J.timespinner("getHours"),J.timespinner("getMinutes"),J.timespinner("getSeconds"))}function D(H,G){E(H,G,true)}function A(I){var H=F.data(I,"datetimebox").options;var G=C(I);E(I,H.formatter.call(I,G));F(I).combo("hidePanel")}function E(I,H,K){var J=F.data(I,"datetimebox").options;F(I).combo("setValue",H);if(!K){if(H){var G=J.parser.call(I,H);F(I).combo("setValue",J.formatter.call(I,G));F(I).combo("setText",J.formatter.call(I,G))}else{F(I).combo("setText",H)}}var G=J.parser.call(I,H);F(I).datetimebox("calendar").calendar("moveTo",G);F(I).datetimebox("spinner").timespinner("setValue",L(G));function L(O){function N(P){return(P<10?"0":"")+P}var M=[N(O.getHours()),N(O.getMinutes())];if(J.showSeconds){M.push(N(O.getSeconds()))}return M.join(F(I).datetimebox("spinner").timespinner("options").separator)}}F.fn.datetimebox=function(H,G){if(typeof H=="string"){var I=F.fn.datetimebox.methods[H];if(I){return I(this,G)}else{return this.datebox(H,G)}}H=H||{};return this.each(function(){var J=F.data(this,"datetimebox");if(J){F.extend(J.options,H)}else{F.data(this,"datetimebox",{options:F.extend({},F.fn.datetimebox.defaults,F.fn.datetimebox.parseOptions(this),H)})}B(this)})};F.fn.datetimebox.methods={options:function(G){var H=G.datebox("options");return F.extend(F.data(G[0],"datetimebox").options,{originalValue:H.originalValue,disabled:H.disabled,readonly:H.readonly})},spinner:function(G){return F.data(G[0],"datetimebox").spinner},setValue:function(G,H){return G.each(function(){E(this,H)})},reset:function(G){return G.each(function(){var H=F(this).datetimebox("options");F(this).datetimebox("setValue",H.originalValue)})}};F.fn.datetimebox.parseOptions=function(G){var H=F(G);return F.extend({},F.fn.datebox.parseOptions(G),F.parser.parseOptions(G,["timeSeparator",{showSeconds:"boolean"}]))};F.fn.datetimebox.defaults=F.extend({},F.fn.datebox.defaults,{showSeconds:true,timeSeparator:":",keyHandler:{up:function(G){},down:function(G){},left:function(G){},right:function(G){},enter:function(G){A(this)},query:function(H,G){D(this,H)}},buttons:[{text:function(G){return F(G).datetimebox("options").currentText},handler:function(G){F(G).datetimebox("calendar").calendar({year:new Date().getFullYear(),month:new Date().getMonth()+1,current:new Date()});A(G)}},{text:function(G){return F(G).datetimebox("options").okText},handler:function(G){A(G)}},{text:function(G){return F(G).datetimebox("options").closeText},handler:function(G){F(this).closest("div.combo-panel").panel("close")}}],formatter:function(H){var G=H.getHours();var L=H.getMinutes();var I=H.getSeconds();function N(M){return(M<10?"0":"")+M}var J=F(this).datetimebox("spinner").timespinner("options").separator;var K=F.fn.datebox.defaults.formatter(H)+" "+N(G)+J+N(L);if(F(this).datetimebox("options").showSeconds){K+=J+N(I)}return K},parser:function(G){if(F.trim(G)==""){return new Date()}var M=G.split(" ");var N=F.fn.datebox.defaults.parser(M[0]);if(M.length<2){return N}var I=F(this).datetimebox("spinner").timespinner("options").separator;var J=M[1].split(I);var H=parseInt(J[0],10)||0;var K=parseInt(J[1],10)||0;var L=parseInt(J[2],10)||0;return new Date(N.getFullYear(),N.getMonth(),N.getDate(),H,K,L)}})})(jQuery);