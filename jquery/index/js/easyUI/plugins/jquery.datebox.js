(function(E){function B(H){var I=E.data(H,"datebox");var J=I.options;E(H).addClass("datebox-f").combo(E.extend({},J,{onShowPanel:function(){F();C(H,E(H).datebox("getText"));J.onShowPanel.call(H)}}));E(H).combo("textbox").parent().addClass("datebox");if(!I.calendar){G()}function G(){var O=E(H).combo("panel").css("overflow","hidden");var K=E('<div class="datebox-calendar-inner"></div>').appendTo(O);if(J.sharedCalendar){I.calendar=E(J.sharedCalendar).appendTo(K);if(!I.calendar.hasClass("calendar")){I.calendar.calendar()}}else{I.calendar=E("<div></div>").appendTo(K).calendar()}E.extend(I.calendar.calendar("options"),{fit:true,border:false,onSelect:function(T){var S=E(this.target).datebox("options");C(this.target,S.formatter(T));E(this.target).combo("hidePanel");S.onSelect.call(H,T)}});C(H,J.value);var Q=E('<div class="datebox-button"><table cellspacing="0" cellpadding="0" style="width:100%"><tr></tr></table></div>').appendTo(O);var P=Q.find("tr");for(var N=0;N<J.buttons.length;N++){var M=E("<td></td>").appendTo(P);var R=J.buttons[N];var L=E('<a href="javascript:void(0)"></a>').html(E.isFunction(R.text)?R.text(H):R.text).appendTo(M);L.bind("click",{target:H,handler:R.handler},function(S){S.data.handler.call(this,S.data.target)})}P.find("td").css("width",(100/J.buttons.length)+"%")}function F(){var L=E(H).combo("panel");var K=L.children("div.datebox-calendar-inner");L.children()._outerWidth(L.width());I.calendar.appendTo(K);I.calendar[0].target=H;if(J.panelHeight!="auto"){var M=L.height();L.children().not(K).each(function(){M-=E(this).outerHeight()});K._outerHeight(M)}I.calendar.calendar("resize")}}function D(F,G){C(F,G)}function A(G){var F=E.data(G,"datebox");var I=F.options;var H=I.formatter(F.calendar.calendar("options").current);C(G,H);E(G).combo("hidePanel")}function C(F,I){var H=E.data(F,"datebox");var G=H.options;E(F).combo("setValue",I).combo("setText",I);H.calendar.calendar("moveTo",G.parser(I))}E.fn.datebox=function(H,G){if(typeof H=="string"){var F=E.fn.datebox.methods[H];if(F){return F(this,G)}else{return this.combo(H,G)}}H=H||{};return this.each(function(){var I=E.data(this,"datebox");if(I){E.extend(I.options,H)}else{E.data(this,"datebox",{options:E.extend({},E.fn.datebox.defaults,E.fn.datebox.parseOptions(this),H)})}B(this)})};E.fn.datebox.methods={options:function(F){var G=F.combo("options");return E.extend(E.data(F[0],"datebox").options,{originalValue:G.originalValue,disabled:G.disabled,readonly:G.readonly})},calendar:function(F){return E.data(F[0],"datebox").calendar},setValue:function(F,G){return F.each(function(){C(this,G)})},reset:function(F){return F.each(function(){var G=E(this).datebox("options");E(this).datebox("setValue",G.originalValue)})}};E.fn.datebox.parseOptions=function(F){return E.extend({},E.fn.combo.parseOptions(F),E.parser.parseOptions(F,["sharedCalendar"]))};E.fn.datebox.defaults=E.extend({},E.fn.combo.defaults,{panelWidth:180,panelHeight:"auto",sharedCalendar:null,keyHandler:{up:function(F){},down:function(F){},left:function(F){},right:function(F){},enter:function(F){A(this)},query:function(G,F){D(this,G)}},currentText:"Today",closeText:"Close",okText:"Ok",buttons:[{text:function(F){return E(F).datebox("options").currentText},handler:function(F){E(F).datebox("calendar").calendar({year:new Date().getFullYear(),month:new Date().getMonth()+1,current:new Date()});A(F)}},{text:function(F){return E(F).datebox("options").closeText},handler:function(F){E(this).closest("div.combo-panel").panel("close")}}],formatter:function(G){var I=G.getFullYear();var H=G.getMonth()+1;var F=G.getDate();return H+"/"+F+"/"+I},parser:function(F){var G=Date.parse(F);if(!isNaN(G)){return new Date(G)}else{return new Date()}},onSelect:function(F){}})})(jQuery);