(function(D){function A(F){var G=D.data(F,"combotree").options;var H=D.data(F,"combotree").tree;D(F).addClass("combotree-f");D(F).combo(G);var E=D(F).combo("panel");if(!H){H=D("<ul></ul>").appendTo(E);D.data(F,"combotree").tree=H}H.tree(D.extend({},G,{checkbox:G.multiple,onLoadSuccess:function(J,K){var N=D(F).combotree("getValues");if(G.multiple){var M=H.tree("getChecked");for(var I=0;I<M.length;I++){var L=M[I].id;(function(){for(var O=0;O<N.length;O++){if(L==N[O]){return}}N.push(L)})()}}D(F).combotree("setValues",N);G.onLoadSuccess.call(this,J,K)},onClick:function(I){C(F);D(F).combo("hidePanel");G.onClick.call(this,I)},onCheck:function(I,J){C(F);G.onCheck.call(this,I,J)}}))}function C(H){var J=D.data(H,"combotree").options;var L=D.data(H,"combotree").tree;var F=[],E=[];if(J.multiple){var I=L.tree("getChecked");for(var G=0;G<I.length;G++){F.push(I[G].id);E.push(I[G].text)}}else{var K=L.tree("getSelected");if(K){F.push(K.id);E.push(K.text)}}D(H).combo("setValues",F).combo("setText",E.join(J.separator))}function B(J,I){var N=D.data(J,"combotree").options;var K=D.data(J,"combotree").tree;K.find("span.tree-checkbox").addClass("tree-checkbox0").removeClass("tree-checkbox1 tree-checkbox2");var L=[],H=[];for(var M=0;M<I.length;M++){var G=I[M];var F=G;var E=K.tree("find",G);if(E){F=E.text;K.tree("check",E.target);K.tree("select",E.target)}L.push(G);H.push(F)}D(J).combo("setValues",L).combo("setText",H.join(N.separator))}D.fn.combotree=function(G,F){if(typeof G=="string"){var E=D.fn.combotree.methods[G];if(E){return E(this,F)}else{return this.combo(G,F)}}G=G||{};return this.each(function(){var H=D.data(this,"combotree");if(H){D.extend(H.options,G)}else{D.data(this,"combotree",{options:D.extend({},D.fn.combotree.defaults,D.fn.combotree.parseOptions(this),G)})}A(this)})};D.fn.combotree.methods={options:function(E){var F=E.combo("options");return D.extend(D.data(E[0],"combotree").options,{originalValue:F.originalValue,disabled:F.disabled,readonly:F.readonly})},tree:function(E){return D.data(E[0],"combotree").tree},loadData:function(E,F){return E.each(function(){var H=D.data(this,"combotree").options;H.data=F;var G=D.data(this,"combotree").tree;G.tree("loadData",F)})},reload:function(E,F){return E.each(function(){var G=D.data(this,"combotree").options;var H=D.data(this,"combotree").tree;if(F){G.url=F}H.tree({url:G.url})})},setValues:function(E,F){return E.each(function(){B(this,F)})},setValue:function(E,F){return E.each(function(){B(this,[F])})},clear:function(E){return E.each(function(){var F=D.data(this,"combotree").tree;F.find("div.tree-node-selected").removeClass("tree-node-selected");var H=F.tree("getChecked");for(var G=0;G<H.length;G++){F.tree("uncheck",H[G].target)}D(this).combo("clear")})},reset:function(E){return E.each(function(){var F=D(this).combotree("options");if(F.multiple){D(this).combotree("setValues",F.originalValue)}else{D(this).combotree("setValue",F.originalValue)}})}};D.fn.combotree.parseOptions=function(E){return D.extend({},D.fn.combo.parseOptions(E),D.fn.tree.parseOptions(E))};D.fn.combotree.defaults=D.extend({},D.fn.combo.defaults,D.fn.tree.defaults,{editable:false})})(jQuery);